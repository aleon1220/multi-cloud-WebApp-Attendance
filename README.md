[![Project Status: Active](https://img.shields.io/badge/Project%20Status-Active-brightgreen.svg)](https://github.com/aleon1220/multi-cloud-WebApp-Attendance/projects)
[![Automation engineers wanted](https://img.shields.io/badge/Automation%20engineers%20wanted-Yes-brightgreen.svg)](https://github.com/my-org/my-project/issues/new)
[![Feedback welcome](https://img.shields.io/badge/Feedback%20welcome-Yes-brightgreen.svg)](https://github.com/aleon1220/multi-cloud-WebApp-Attendance/issues/new)

- [Attendance WebApp](#attendance-webapp)
  - [Introduction](#introduction)
  - [GitHub Reports](#github-reports)
    - [GitHub Reports](#github-reports)
    - [Security warnings](#security-warnings)
    - [GitHub Vulnerability report](#github-vulnerability-report)
    - [GitHub Vulnerability report](#github-vulnerability-report)
  - [Attendance WebApp Architecture (re-architected)](#attendance-webapp-architecture-re-architected)
    - [2018-Attendance WebApp high level Architecture](#2018-attendance-webapp-high-level-architecture)
    - [Attendance WebApp UI](#attendance-webapp-ui)
  - [Refer to the Wiki for details on the project](#refer-to-the-wiki-for-details-on-the-project)
- [Quickstart](#quickstart)
- [Local Setup](#local-setup)
  - [Project general guidelines](#project-general-guidelines)
    - [Maven Build](#maven-build)
    - [Gradle Test suite](#gradle-test-suite)
      - [Use 1Password CLI to inject the secrets](#use-1password-cli-to-inject-the-secrets)
  - [Package/Run WebApp](#packagerun-webapp)
    - [Docker Image Build](#docker-image-build)
      - [Available Tomcat versions](#available-tomcat-versions)
  - [Execute WebApp](#execute-webapp)
    - [Container Execution](#container-execution)
      - [Docker execution](#docker-execution)
      - [Docker-compose](#docker-compose)
  - [Editing project diagrams](#editing-project-diagrams)
- [References](#references)

# Attendance WebApp

## Introduction

Attendance WebApp is an app to improve the way attendance is managed at training and education institutions.
The student will have a short timeframe to submit a random generated code by the lecturer so that attendance can be registered in the system.

## GitHub Security Reports
> Security Warnings to check
GitHub found vulnerabilities on aleon1220/multi-cloud-WebApp-Attendance's default branch (2 moderate).
To find out more, visit:

- [multi-cloud-WebApp-Attendance/security report](https://github.com/aleon1220/multi-cloud-WebApp-Attendance/security)
- [GitHub Vulnerability report](https://github.com/aleon1220/multi-cloud-WebApp-Attendance/security/dependabot)

## Attendance WebApp AttendTrak Architecture
(re-architected) project with simplifications to make it more generalized and use in CI/CD DevSecOps pipelines.

> Refer to the Wiki for details on the project

[Detailed Project Wiki][95f44386]

  [95f44386]: https://github.com/aleon1220/multi-cloud-AttendWebApp/wiki/4-Architecture-and-Technical-Design "Project Wiki"

### Goals of new webapp
* use diagrams.net for the diagrams
* where possible use mermaid diagrams
* Simplification of used services
* Streamline app to use 100% REST
* Deprecate SOAP and WSDL
* Leverage OpenLDAP instance for users and roles
* Host the WebApp in Azure
* Host the backend functionality in AWS

### 2018-Attendance WebApp
2018 university project. Registers Class attendance and interacts with AWS and microservices hosted on a private cloud.

#### High level Architecture
![Multi Cloud architecture](https://imgur.com/LDVqx71.jpg)

#### Class Attendance UI
a random code is generated by the lecturer or trainer. The students have a timeframe of 30 seconds to enter the code on their end.

![Attendance Web App](https://github.com/aleon1220/multi-cloud-AttendWebApp/wiki/images/2018/05/random-code-generation.png)

---
# AttendTrack Quickstart
## Pre-requisites
- Clone repo HTTPS
```bash
git clone https://github.com/aleon1220/multi-cloud-WebApp-Attendance.git
```
- Clone Repo SSH
```bash
git clone git@github.com:aleon1220/multi-cloud-WebApp-Attendance.git
```
- open repository in chosen IDE
  - IDEs can be Eclipse
  - IntelliJ (suggested)
  - use online IDE (Github codespaces)

1. leverage the bash script to build/run locally
2. use docker compose to build/run composite webapp stack
3. instructions on how to leverage Pulumi to run in a Cloud provider
4. Instructions on how to run the app with the ADO instance for DevSecOps CI/CD

## 1 Run Locally simple execution
> Tested in Win11 with WSL, Github codespaces and Linux Ubuntu 22
- A Bash script `runme.sh` created to automate the local development.
Cleans, builds and executes the docker-compose stack locally. Provides a version number for the app found from the build.gradle file

```bash
./runme.sh clean ; ./runme.sh build ; ./runme.sh run
```

- Gradle Build Web Package
build and test the .WAR WebArchive file. The .WAR file located at `build/libs/*.war`
``` bash
gradle clean build --console plain --warning-mode all
```
- Gradle Check the generated version from the build.gradle.kts
```bash
gradle getAppversion
```
- localDev Run the WebApp
Run the tomcat server with the latest pre-built WAR web Archive file
Run from [Docker Hub](https://hub.docker.com/repository/docker/aleon1220/soa/general)
```bash
docker run --interactive --tty --detach --publish 8080:8080 --name attendance_webapp_container aleon1220/soa:latest
```

#### Use 1Password CLI to inject the secrets
- as a pre-requisite you must have access to the shared vault
- login in the CLI
```bash
# Linux Ubuntu tested 2023-12-10
op signin
```
- inject the secrets for testing Authentication property file
```bash
op inject -i token_auth.properties.tpl -o token_auth.properties
```

- inject the secrets for Testing property file
```bash
op inject -i secrets.env.tpl -o secrets.env
```

- inject the secrets for Testing docker-compose
```bash
op inject -i .env.tpl -o .env
```

## Package/Run WebApp
### Gradle tasks
#### Build & Test suite
### Docker Image Build
- Build the app image with Docker. Deploy .WAR file in Tomcat
refer to https://hub.docker.com/_/tomcat
```bash
docker build --build-arg APP_WAR_FILE_VERSION=$APP_WAR_FILE_VERSION --tag aleon1220/soa:$APP_WAR_FILE_VERSION .
```

#### Available Tomcat versions
if you need to edit the Dockerfile and upgrade the servlet container Tomcat version
- 7.0.109 = `TOMCAT_VERSION_DOCKER_TAG="7.0.109-jdk8-openjdk"`
- 9.0.78  = `TOMCAT_VERSION_DOCKER_TAG="9.0.78-jre8"`

## Execute WebApp
### Container Execution
#### Docker execution

### Execute WebApp Container Execution
#### Docker execution by image version
Test the immutable webapp from Docker
```bash
docker run --interactive --tty --detach --publish 8080:8080 --name $APP_WAR_FILE_VERSION aleon1220/soa:$APP_WAR_FILE_VERSION
```

##### local development & executions
Test the container webapp after building the image locally
```bash
docker run --interactive --tty --detach --publish 8080:8080 --name attendance_webapp_container aleon1220/soa:$APP_WAR_FILE_VERSION
```
- Get the name of the running container
- get the name of the running container
``` bash
CONTAINER_NAME=$(docker container ls --all --filter publish=8080 --format "{{.Names}}")
```
- Access the Docker container via CLI
```bash
docker container exec -it $CONTAINER_NAME /bin/bash
```
- The URl is URL:8080/Attendance-0.0.1 [AttendanceWebApp](http://localhost:8080/AttendanceWebApp)
- clean up docker container environment
``` bash
docker stop $(docker ps --quiet)
docker rm $(docker container ls --all --quiet)
```
## 2 Run composite app docker compose
Docker compose executes the full composite app

To execute secrets I use 1Password with some pre-configured vaults.

secrets for Testing docker-compose require
- .env file environment file variables
- ldap/userDirectory.ldif users from LDAP directory

- inject secrets for .env file
```bash
op inject -i .env.tpl -o .env
```
- inject secrets for LDAP .ldif file
```bash
op inject -i ./ldap/userDirectory.ldif.tpl -o ./ldap/userDirectory.ldif
```
- example load single secret to a system variable
```bash
export LDAP_ADMIN_PASS=$(op read "op://uqbpxejq7gifvi6mg3c7xxokre/jvuj7juvlxlg7delckucvidqhi/password")
```
- load the environment variables
```bash
source .env
```

load LDIF file
ldapmodify -x -D "cn=admin,dc=latintech,dc=org" -w "$LDAP_ADMIN_PASS" -f ./ldap/userDirectory.ldif

- run the docker compose stack
```bash
docker compose down ; ./runme.sh build ; docker compose up --detach
```
- check compose logs
```bash
docker compose logs --follow
```
## Editing project diagrams
- From [diagrams.net](https://app.diagrams.net/?src=about) > Open the XML file [project-diagrams.drawio](./project-diagrams.drawio)
- Export images to preferred format and update this README

> maven has been deprecated and moved to [maven](./maven)